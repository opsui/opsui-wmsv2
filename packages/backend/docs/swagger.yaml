# WMS API Documentation
# OpenAPI/Swagger specification for Warehouse Management System API

openapi: 3.0.3
info:
  title: Warehouse Management System API
  description: |
    RESTful API for the Warehouse Management System (WMS).

    ## Authentication

    All endpoints except `/api/auth/*` require authentication via JWT token.

    Include the token in the Authorization header:
    ```
    Authorization: Bearer <your-jwt-token>
    ```

    ## Rate Limiting

    - 100 requests per 15 minutes per IP
    - 5 requests per 15 minutes for authentication endpoints

    ## Response Format

    All responses follow this structure:
    ```json
    {
      "data": { ... },
      "error": null,
      "code": "SUCCESS"
    }
    ```

    Errors follow this structure:
    ```json
    {
      "error": "Error message",
      "code": "ERROR_CODE",
      "details": { ... }
    }
    ```
  version: 1.0.0
  contact:
    name: WMS Support
    email: support@wms.example.com
  license:
    name: ISC

servers:
  - url: https://api.wms.example.com/api/v1
    description: Production server
  - url: https://staging-api.wms.example.com/api/v1
    description: Staging server

security:
  - BearerAuth: []

tags:
  - name: Authentication
    description: User authentication and authorization
  - name: Orders
    description: Order management
  - name: Inventory
    description: Inventory and stock management
  - name: Products
    description: Product catalog management
  - name: Users
    description: User management
  - name: Locations
    description: Warehouse locations and bins
  - name: Reports
    description: Reporting and analytics

# ============================================================================
# SECURITY SCHEMES
# ============================================================================
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # ============================================================================
    # COMMON SCHEMAS
    # ============================================================================
    Error:
      type: object
      required:
        - error
        - code
      properties:
        error:
          type: string
          description: Human-readable error message
        code:
          type: string
          description: Machine-readable error code
        details:
          type: object
          description: Additional error details

    SuccessResponse:
      type: object
      required:
        - data
        - code
      properties:
        data:
          type: object
          description: Response data
        code:
          type: string
          description: Response code
          example: SUCCESS

    PaginatedResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
        properties:
          data:
            type: object
            required:
              - items
              - total
            properties:
              items:
                type: array
                items: {}
              total:
                type: integer
                description: Total number of items
              page:
                type: integer
                description: Current page number
              pageSize:
                type: integer
                description: Number of items per page

    # ============================================================================
    # AUTHENTICATION SCHEMAS
    # ============================================================================
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User email address
        password:
          type: string
          format: password
          minLength: 8
          description: User password

    LoginResponse:
      type: object
      required:
        - token
        - refreshToken
        - user
      properties:
        token:
          type: string
          description: JWT access token
        refreshToken:
          type: string
          description: JWT refresh token
        user:
          $ref: '#/components/schemas/User'

    RefreshTokenRequest:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string
          description: JWT refresh token

    # ============================================================================
    # USER SCHEMAS
    # ============================================================================
    User:
      type: object
      required:
        - userId
        - email
        - name
        - role
        - active
      properties:
        userId:
          type: string
          description: Unique user identifier
        email:
          type: string
          format: email
          description: User email address
        name:
          type: string
          description: User's full name
        role:
          type: string
          enum: [ADMIN, SUPERVISOR, PICKER, PACKER, CUSTOMER]
          description: User role
        active:
          type: boolean
          description: Whether the user is active
        createdAt:
          type: string
          format: date-time
          description: Account creation timestamp
        lastLoginAt:
          type: string
          format: date-time
          description: Last login timestamp

    CreateUserRequest:
      type: object
      required:
        - email
        - password
        - name
        - role
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 12
        name:
          type: string
        role:
          type: string
          enum: [ADMIN, SUPERVISOR, PICKER, PACKER]

    # ============================================================================
    # ORDER SCHEMAS
    # ============================================================================
    Order:
      type: object
      required:
        - orderId
        - customerName
        - status
        - priority
        - createdAt
      properties:
        orderId:
          type: string
          description: Unique order identifier
        customerName:
          type: string
          description: Customer name
        customerEmail:
          type: string
          format: email
          description: Customer email
        status:
          type: string
          enum: [pending, picking, picked, packing, packed, shipped, delivered, cancelled]
          description: Order status
        priority:
          type: string
          enum: [low, normal, high, urgent]
          description: Order priority
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        notes:
          type: string
          description: Order notes
        pickerId:
          type: string
          description: Assigned picker ID
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    OrderItem:
      type: object
      required:
        - sku
        - quantity
      properties:
        sku:
          type: string
          description: Product SKU
        quantity:
          type: integer
          minimum: 1
          description: Item quantity
        binLocation:
          type: string
          description: Bin location
        productName:
          type: string
          description: Product name

    CreateOrderRequest:
      type: object
      required:
        - customerName
        - items
      properties:
        customerName:
          type: string
        customerEmail:
          type: string
          format: email
        items:
          type: array
          items:
            type: object
            required:
              - sku
              - quantity
            properties:
              sku:
                type: string
              quantity:
                type: integer
                minimum: 1
        notes:
          type: string
        priority:
          type: string
          enum: [low, normal, high, urgent]

    # ============================================================================
    # INVENTORY SCHEMAS
    # ============================================================================
    Inventory:
      type: object
      required:
        - productId
        - sku
        - quantityAvailable
        - quantityAllocated
        - location
      properties:
        productId:
          type: string
        sku:
          type: string
        quantityAvailable:
          type: integer
          minimum: 0
        quantityAllocated:
          type: integer
          minimum: 0
        location:
          type: string
          description: Bin location (format: A-01-01)

# ============================================================================
# PATHS
# ============================================================================
paths:
  # ===========================================================================
  # AUTHENTICATION ENDPOINTS
  # ===========================================================================
  /auth/login:
    post:
      tags:
        - Authentication
      summary: Login user
      description: Authenticate user with email and password
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: user@example.com
              password: SecurePassword123!
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                  - properties:
                      data:
                        $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Get new access token using refresh token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: Token refreshed successfully
        '401':
          description: Invalid or expired refresh token

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      description: Invalidate current session
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Logout successful
        '401':
          description: Not authenticated

  /auth/me:
    get:
      tags:
        - Authentication
      summary: Get current user
      description: Get information about currently authenticated user
      security:
        - BearerAuth: []
      responses:
        '200':
          description: User information retrieved
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                  - properties:
                      data:
                        $ref: '#/components/schemas/User'
        '401':
          description: Not authenticated

  # ===========================================================================
  # ORDER ENDPOINTS
  # ===========================================================================
  /orders:
    get:
      tags:
        - Orders
      summary: List orders
      description: Get list of orders with filtering and pagination
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, picking, picked, packing, packed, shipped, delivered, cancelled]
          description: Filter by order status
        - name: priority
          in: query
          schema:
            type: string
            enum: [low, normal, high, urgent]
          description: Filter by priority
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            maximum: 100
          description: Number of items to return
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
          description: Number of items to skip
      responses:
        '200':
          description: Orders retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'

    post:
      tags:
        - Orders
      summary: Create order
      description: Create a new order
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                  - properties:
                      data:
                        $ref: '#/components/schemas/Order'
        '400':
          description: Invalid input
        '409':
          description: Insufficient inventory

  /orders/{orderId}:
    get:
      tags:
        - Orders
      summary: Get order by ID
      description: Retrieve specific order details
      security:
        - BearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
          description: Order ID
      responses:
        '200':
          description: Order retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                  - properties:
                      data:
                        $ref: '#/components/schemas/Order'
        '404':
          description: Order not found

    patch:
      tags:
        - Orders
      summary: Update order
      description: Update order status or other fields
      security:
        - BearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [picking, picked, packing, packed, shipped, delivered, cancelled]
                priority:
                  type: string
                  enum: [low, normal, high, urgent]
                notes:
                  type: string
      responses:
        '200':
          description: Order updated successfully
        '404':
          description: Order not found

    delete:
      tags:
        - Orders
      summary: Cancel order
      description: Cancel an existing order
      security:
        - BearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Order cancelled successfully
        '404':
          description: Order not found
        '409':
          description: Order cannot be cancelled (already shipped/delivered)

  # ===========================================================================
  # ORDER ACTIONS
  # ===========================================================================
  /orders/{orderId}/claim:
    post:
      tags:
        - Orders
      summary: Claim order for picking
      description: Picker claims an order to fulfill
      security:
        - BearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Order claimed successfully
        '404':
          description: Order not found
        '409':
          description: Order already claimed

  /orders/{orderId}/complete:
    post:
      tags:
        - Orders
      summary: Complete order
      description: Mark order as completed by picker
      security:
        - BearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Order completed successfully
        '404':
          description: Order not found
        '409':
          description: Order cannot be completed in current status

  # ===========================================================================
  # INVENTORY ENDPOINTS
  # ===========================================================================
  /inventory:
    get:
      tags:
        - Inventory
      summary: List inventory
      description: Get inventory items with filtering
      security:
        - BearerAuth: []
      parameters:
        - name: sku
          in: query
          schema:
            type: string
          description: Filter by SKU
        - name: location
          in: query
          schema:
            type: string
          description: Filter by bin location
        - name: lowStock
          in: query
          schema:
            type: boolean
          description: Only show items with low stock
      responses:
        '200':
          description: Inventory retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'

  /inventory/{sku}:
    get:
      tags:
        - Inventory
      summary: Get inventory by SKU
      description: Get inventory details for specific product
      security:
        - BearerAuth: []
      parameters:
        - name: sku
          in: path
          required: true
          schema:
            type: string
          description: Product SKU
      responses:
        '200':
          description: Inventory retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                  - properties:
                      data:
                        $ref: '#/components/schemas/Inventory'
        '404':
          description: SKU not found

    patch:
      tags:
        - Inventory
      summary: Adjust inventory
      description: Adjust inventory quantities
      security:
        - BearerAuth: []
      parameters:
        - name: sku
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                quantity:
                  type: integer
                  description: Quantity to add (positive) or remove (negative)
                location:
                  type: string
                  description: Bin location
                reason:
                  type: string
                  description: Reason for adjustment
      responses:
        '200':
          description: Inventory adjusted successfully
        '400':
          description: Invalid request
        '404':
          description: SKU not found

  # ===========================================================================
  # PRODUCT ENDPOINTS
  # ===========================================================================
  /products:
    get:
      tags:
        - Products
      summary: List products
      description: Get list of products
      security:
        - BearerAuth: []
      parameters:
        - name: search
          in: query
          schema:
            type: string
          description: Search in name/SKU
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: Products retrieved successfully

  /products/{sku}:
    get:
      tags:
        - Products
      summary: Get product by SKU
      description: Get product details
      security:
        - BearerAuth: []
      parameters:
        - name: sku
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Product retrieved successfully
        '404':
          description: Product not found

  # ===========================================================================
  # USER ENDPOINTS
  # ===========================================================================
  /users:
    get:
      tags:
        - Users
      summary: List users
      description: Get list of users
      security:
        - BearerAuth: []
      parameters:
        - name: role
          in: query
          schema:
            type: string
            enum: [ADMIN, SUPERVISOR, PICKER, PACKER, CUSTOMER]
          description: Filter by role
        - name: active
          in: query
          schema:
            type: boolean
          description: Filter by active status
      responses:
        '200':
          description: Users retrieved successfully

    post:
      tags:
        - Users
      summary: Create user
      description: Create new user account
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: User created successfully
        '400':
          description: Invalid input
        '409':
          description: User already exists

  # ===========================================================================
  # LOCATION ENDPOINTS
  # ===========================================================================
  /locations:
    get:
      tags:
        - Locations
      summary: List locations
      description: Get warehouse bin locations
      security:
        - BearerAuth: []
      parameters:
        - name: zone
          in: query
          schema:
            type: string
            pattern: ^[A-Z]$
            description: Filter by zone
        - name: available
          in: query
          schema:
            type: boolean
          description: Only show locations with available capacity
      responses:
        '200':
          description: Locations retrieved successfully

  /locations/{locationId}:
    get:
      tags:
        - Locations
      summary: Get location details
      description: Get specific bin location information
      security:
        - BearerAuth: []
      parameters:
        - name: locationId
          in: path
          required: true
          schema:
            type: string
          description: Location ID
      responses:
        '200':
          description: Location retrieved successfully
        '404':
          description: Location not found

  # ===========================================================================
  # REPORTS ENDPOINTS
  # ===========================================================================
  /reports/order-fulfillment:
    get:
      tags:
        - Reports
      summary: Order fulfillment report
      description: Get order fulfillment metrics
      security:
        - BearerAuth: []
      parameters:
        - name: startDate
          in: query
          schema:
            type: string
            format: date
            description: Report start date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
            description: Report end date
      responses:
        '200':
          description: Report generated successfully

  /reports/inventory-status:
    get:
      tags:
        - Reports
      summary: Inventory status report
      description: Get current inventory status metrics
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Report generated successfully

  # ===========================================================================
  # HEALTH ENDPOINTS
  # ===========================================================================
  /health:
    get:
      tags:
        - System
      summary: Health check
      description: Check system health status
      security: []
      responses:
        '200':
          description: System is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [healthy, degraded, unhealthy]
                  timestamp:
                    type: string
                    format: date-time
                  services:
                    type: object
                    properties:
                      database:
                        type: string
                        enum: [ok, error]
                      redis:
                        type: string
                        enum: [ok, error, disabled]
